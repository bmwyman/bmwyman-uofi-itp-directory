@page "/profile/general/{refresh?}"

<PageTitle>Profile | Illinois</PageTitle>
<NavigationLock OnBeforeInternalNavigation=this.LocationChangingHandler ConfirmExternalNavigation=_isDirty />
@if (Employee != null)
{
<il-section>
    <h1>@Employee.ProfileName</h1>
    <p>Welcome to @(Employee.IsCurrentUser ? "your profile" : "the profile of " + Employee.ProfileName)! Edit the profile information below. Note that you may not be able to edit everything on this page. Some information is only editable by the employee, and others are only editable by the person who manages your office.</p>
        <Instructions ChildContent="@Instructions"></Instructions>

        @if (!string.IsNullOrWhiteSpace(ShowBackButton) && ShowBackButton == "add")
        {
            <p><a href="/office/people" class="il-button">Back to Adding People</a></p>
        }
        @if (!string.IsNullOrWhiteSpace(ShowBackButton) && ShowBackButton == "search")
        {
            <p><a href="/search/people" class="il-button">Back to Searching for People</a></p>
        }

    <h2>General Information</h2>
    <h3>Preferred Name</h3>
    <div class="iled-section-split">
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-firstname">First Name</label>
                    <input autocomplete="given-name" id="ed-firstname" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.PreferredNameFirst" @bind:after="SetDirty">
            </div>
            <div class="iled-instructions">
                You may <a href="https://go.uillinois.edu/myprofile">edit this in the My UI Info</a> and it will update your directory information as well. If blank, we are pulling your information from My UI Info.
            </div>
        </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-lastname">Last Name</label>
                    <input autocomplete="family-name" id="ed-lastname" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.PreferredNameLast" @bind:after="SetDirty">
            </div>
            <div class="iled-instructions">
                You may <a href="https://go.uillinois.edu/myprofile">edit this in the My UI Info</a> and it will update your directory information as well. If blank, we are pulling your information from My UI Info.
            </div>
        </div>
    </div>
    <h3>Preferred Pronouns</h3>
    <div class="iled-section-split">
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-pronoun-template">Pronoun Templates</label>
                    <select id="ed-pronoun-template" @bind="Employee.PreferredPronouns" disabled="@Employee.IsEntryDisabled" @bind:after="SetDirty">
                        <option value="">(blank)</option>
                        <option value="he/him">he/him</option>
                        <option value="she/her">she/her</option>
                        <option value="they/them">they/them</option>
                        <option value="">other</option>
                    </select>
                </div>
                <div class="iled-instructions">
                    Pronoun disclosure is an individual choice and not a mandate.
                </div>
            </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-pronouns">Pronouns</label>
                    <input id="ed-pronouns" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.PreferredPronouns" @bind:after="SetDirty">
            </div>
        </div>
    </div>

    @if (IsMultiple)
    {
            <h3>Primary Office</h3>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-primaryoffice">Primary Office</label>
                    <select id="ed-primaryoffice" @bind="Employee.PrimaryProfile" @bind:after="SetDirty">
                        @foreach (var profile in Employee.JobProfiles)
                        {
                            <option value="@profile.OfficeId">@profile.Title / @profile.Office.Title</option>
                        }
                    </select>
                </div>
                <div class="iled-instructions">
                    Your primary profile is what shows up as your title if someone is looking at your profile. If not chosen, then the first one created will be your profile.
                </div>
            </div>

    }
    <h3>Job Title(s)</h3>
    @foreach (var profile in Employee.JobProfiles)
    {
        @if (Employee.JobProfiles.Count > 1 && profile.OfficeId == Employee.PrimaryJobProfile.OfficeId)
        {
            <h4>@profile.Office.Title (primary)</h4>
        } else
        {
            <h4>@profile.Office.Title</h4>
        }
        <div class="iled-section-split">
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-title-@profile.Id">Title</label>
                        <input id="ed-title-@profile.Id" type="text" disabled="@profile.IsEntryDisabled" @bind="profile.Title" @bind:after="SetDirty">
                </div>
            </div>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-type-@profile.Id">Job Type</label>
                        <select id="ed-type-@profile.Id" @bind="profile.Category" disabled="@profile.IsEntryDisabled" @bind:after="SetDirty">
                    @foreach (var enumtype in Enum.GetValues<ProfileCategoryTypeEnum>())
                    {
                            <option value="@enumtype">@enumtype.ToPrettyString()</option>
                    }
                    </select>
                </div>
                <div class="iled-instructions">
                    A job type of "None" means the person will not be listed.
                </div>
            </div>
        </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-description-@profile.Id">Description</label>
                    <textarea id="ed-description-@profile.Id" type="text" disabled="@profile.IsEntryDisabled" @bind="profile.Description" @bind:after="SetDirty"></textarea>
            </div>
            <div class="iled-instructions">
                Job profile description, used for office-specific directories
            </div>
        </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-order-@profile.Id">Display Order</label>
                <select id="ed-order-@profile.Id" @bind="profile.ProfileDisplay" disabled="@profile.IsEntryDisabled">
                    @foreach (var enumtype in Enum.GetValues<ProfileDisplayEnum>().OrderBy(o => o))
                    {
                        <option value="@enumtype">@enumtype.ToPrettyString()</option>
                    }
                </select>
            </div>
            <div class="iled-instructions">
                Profiles are normally listed in alphabetical order. This allows an administrator to manually change the order of the profile. 
            </div>
        </div>
            @if (AreaTags.ContainsKey(profile.Office.AreaId) && AreaTags[profile.Office.AreaId].Any())
            {
                <div class="iled-section-split">
                    <div class="iled-input-box-parent iled-input-box-buttons">
                        <h5>Available Tags</h5>
                        @foreach (var tag in AreaTags[profile.Office.AreaId])
                        {
                            <button disabled="@(profile.IsEntryDisabled && tag.AllowEmployeeToEdit)" class="il-button" @onclick="() => AddTag(tag, profile)">@tag.Title</button>
                        }
                    </div>
                    <div class="iled-input-box-parent iled-input-box-buttons">
                        <h5>Tags Applied to Profile</h5>
                        @foreach (var tag in profile.Tags)
                        {
                            <button disabled="@(profile.IsEntryDisabled && tag.AllowEmployeeToEdit)" class="il-button" @onclick="() => RemoveTag(tag, profile)">@tag.Title</button>
                        }
                    </div>
                </div>
             }
        }
        <h3>Office Address and Phone Number</h3>
        <p>This information <a href="https://go.uillinois.edu/myprofile">can also be edited in the My UI Info</a>. If this information is left blank, it will use the My UI Info.</p>
        <div class="iled-section-split">
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-room">Room Number</label>
                    <input id="ed-room" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.Room" @bind:after="SetDirty">
                </div>
            </div>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-building">Building</label>
                    <input id="ed-building" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.Building" @bind:after="SetDirty">
                </div>
            </div>
        </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-address1">Address Line 1</label>
                <input id="ed-address1" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.AddressLine1" @bind:after="SetDirty">
            </div>
        </div>
        <div class="iled-input-box-parent">
            <div class="iled-input-box">
                <label for="ed-address2">Address Line 2</label>
                <input id="ed-address2" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.AddressLine2" @bind:after="SetDirty">
            </div>
        </div>
        <div class="iled-section-split-3">
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-city">City</label>
                    <input id="ed-city" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.City" @bind:after="SetDirty">
                </div>
            </div>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-state">State</label>
                    <input id="ed-state" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.State" @bind:after="SetDirty">
                </div>
            </div>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-zipcode">Zip Code</label>
                    <input id="ed-zipcode" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.ZipCode" @bind:after="SetDirty">
                </div>
            </div>
        </div>
        <div class="iled-section-split">
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-phone">Phone Number</label>
                    <input id="ed-phone" type="text" disabled="@Employee.IsEntryDisabled" @bind="Employee.Phone" @bind:after="SetDirty">
                </div>
            </div>
            <div class="iled-input-box-parent">
                <div class="iled-input-box">
                    <label for="ed-hidephone">Hide Phone Number</label>
                    <input id="ed-hidephone" type="checkbox" disabled="@Employee.IsEntryDisabled" @bind="Employee.IsPhoneHidden" @bind:after="SetDirty">
                </div>
                <div class="iled-instructions">
                    This will allow you to not display your phone number even if it is <a href="https://go.uillinois.edu/myprofile">listed in My UI Info</a>.
                </div>
            </div>
        </div>
        <div class="iled-buttons-left">
        <button class="il-button" @onclick="Send" disabled="@Employee.IsEntryDisabled" @onblur="RemoveMessage">Save</button>
        <ViewProfile NetId="@Employee.NetId"></ViewProfile>
    </div>
    <ToastPopup></ToastPopup>

</il-section>
}
